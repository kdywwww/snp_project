# 새 VM, 새 부팅디스크를 만들고, 기존 디스크의 내용을 복사해오는 방법

## 1단계: 기존 VM 중지 및 디스크 준비 🛑
데이터 무결성을 보장하기 위해 기존 VM을 중지하고, 원본 디스크를 백업합니다.
기존 VM 중지: 데이터를 복사해 올 기존 VM 인스턴스를 **'중지'**합니다.
원본 디스크 스냅샷 생성 (선택 사항): GCP 콘솔의 [디스크] 페이지에서 기존 부팅 디스크의 스냅샷을 생성하여 백업해 둡니다.

## 2단계: 새 VM 및 부팅 디스크 생성 ✨
데이터를 복사해 올 목표 환경(새 OS와 작은 디스크)을 구축합니다.
새 VM 생성: GCP 콘솔에서 새로운 VM 인스턴스를 생성합니다.
OS: 기존 VM과 동일한 OS를 선택하는 것이 가장 좋습니다.
부팅 디스크: VM 생성 과정에서 부팅 디스크 크기를 목표하는 **작은 크기(예: 100GB)**로 지정합니다.
  . 다음 사항 유의 : 고정 IP 연결, 로컬 SSHKEY.PUB 등록, 모든 Cloud API에 대한 전체 액세스 허용, startup-script 설정
VM 시작: VM 생성을 완료하고 인스턴스를 시작합니다. (이 VM은 이제 작은 새 디스크로 정상 부팅됩니다.)

## 3단계: 기존 디스크를 새 VM에 연결 🔗
데이터가 담긴 원본 디스크를 새 VM에 읽기 전용으로 연결하여 안전하게 데이터를 가져옵니다.
원본 디스크 분리: GCP 콘솔 [디스크] 페이지로 이동하여 기존 VM의 부팅 디스크를 선택하고, 1단계에서 중지한 기존 VM으로부터 디스크를 **'분리'**합니다.
원본 디스크 연결: 2단계에서 만든 새 VM 인스턴스 상세 페이지로 이동하여 **'수정'**을 클릭합니다.
**'기존 디스크 연결'**을 클릭하고 원본 디스크를 선택합니다.
중요: 연결 시 **'액세스 모드'**를 **'읽기 전용(Read only)'**으로 설정하여 실수로 원본 데이터를 손상시키지 않도록 합니다.
**'저장'**을 클릭합니다.


## 4단계: 데이터 복사 (rsync) 💾
새 VM에 SSH로 접속하여 마운트 및 데이터 복사 작업을 진행합니다.

4.1. 원본 디스크 마운트: 새 VM에 SSH로 접속하여 연결된 원본 디스크를 마운트합니다.
# lsblk 명령어로 연결된 원본 디스크 파티션 장치명 확인 (예: /dev/sdb1)
lsblk 
# 마운트 포인트 생성 및 마운트
sudo mkdir /mnt/old_data
sudo mount /dev/[원본_디스크_파티션] /mnt/old_data

4.2. 데이터 복사 (rsync): rsync 명령어를 사용하여 필요한 폴더만 새 부팅 디스크(현재의 /)로 복사합니다.
  . rsync는 cp와 달리 권한 등 설정까지도 복사 가능
GitHub 연결 및 사용자 설정 복사 예시: (Git, SSH 설정 파일들은 보통 /home/[사용자명] 내에 숨겨진 파일로 존재합니다.)
# 1. 새 디스크에 사용자 폴더가 없다면 먼저 생성
sudo mkdir -p /home/[사용자명]
# 2. .ssh, .gitconfig, project 폴더 등 필요한 것만 복사
# aAXv 옵션은 퍼미션, 소유권 등을 유지하면서 복사합니다.
sudo rsync -aAXv /mnt/old_data/home/[사용자명]/.ssh/ /home/[사용자명]/.ssh/
sudo rsync -aAXv /mnt/old_data/home/[사용자명]/.gitconfig /home/[사용자명]/
# 3. 프로젝트 폴더 복사 예시
sudo rsync -aAXv /mnt/old_data/home/[사용자명]/snp_project/ /home/[사용자명]/snp_project/
# (필요한 다른 폴더들도 이와 같이 복사합니다.)


## 5단계: 마무리 및 정리
원본 디스크 언마운트: 복사가 완료되면, 원본 디스크를 안전하게 언마운트합니다.
sudo umount /mnt/old_data
디스크 분리: GCP 콘솔에서 새 VM을 다시 수정하고, 3단계에서 연결했던 원본 디스크를 분리합니다.
최종 확인: 새 VM에 SSH로 다시 접속하여 복사된 폴더들이 정상적으로 접근 가능하고, GitHub 연결(SSH 키 등)이 정상 작동하는지 확인합니다.

## 6단계: git 및 docker 재설치
VM OS에 맞춰 "debian docker install"을 검색하여 참조 (LLM 오류 가능성 높음)